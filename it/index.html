<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BroFlix - Watch Movies & Series</title>
    <link rel="icon" type="image/x-icon" href="logo.png">
    <meta name="description" content="Free movies and tv shows">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #141414;
            color: white;
            overflow-x: hidden;
        }

        header {
            position: fixed;
            width: 100%;
            background: linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0) 100%);
            padding: 20px 40px;
            z-index: 1000;
        }

        nav {
            display: flex;
            align-items: center;
            justify-content: space-between; /* This will help separate the elements */
        }

        .nav-left {
            display: flex;
            align-items: center;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 15px; /* Space between search icon and profile */
        }

        .logo {
            color: #e50914;
            font-size: 28px;
            font-weight: bold;
            text-decoration: none;
        }

        .nav-links {
            margin-left: 40px;
            display: flex;
            gap: 30px;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            font-size: 16px;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: #e50914;
        }

        .featured {
            position: relative;
            height: 80vh;
            width: 100%;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .featured-image {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)),
                        url('https://image.tmdb.org/t/p/original/mxVpkHclXPgWxo62SJ0a0YcUzgC.jpg') center/cover;
        }

        .featured-content {
            position: relative;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 0 40px;
            max-width: 1000px;
        }

        .watch-button {
            background-color: #e50914;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 4px;
            font-size: 18px;
            cursor: pointer;
            width: fit-content;
            text-decoration: none;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            gap: 10px; /* Space between text and icon */
        }

        .watch-button img {
            width: 20px; /* Adjust size as needed */
            height: 20px;
            filter: invert(1); /* This will make the black icon white */
        }

        .watch-button:hover {
            background-color: #f40612;
        }

        .movie-section {
            position: relative;
            padding: 20px;
        }

        .movie-section h2 {
            margin-bottom: 10px;
        }

        .movie-row-container {
            position: relative;
            overflow: hidden;
        }

        .movie-row {
            display: flex;
            gap: 15px;
            padding: 10px 0;
            transition: transform 0.5s ease;
        }

        .movie-card {
            min-width: 300px;
            height: 169px;
            border-radius: 4px;
            transition: transform 0.3s;
            cursor: pointer;
            overflow: hidden;
            position: relative;
        }

        .movie-card:hover {
            transform: scale(1.05);
        }

        .movie-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 4px;
        }

        .scroll-button {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 60px; /* Wider button area */
            background: linear-gradient(90deg, 
                rgba(0, 0, 0, 0.7) 0%,
                rgba(0, 0, 0, 0.5) 100%);
            border: none;
            color: white;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s ease, transform 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        .scroll-button::before {
            content: '';
            width: 25px;
            height: 25px;
            border: 2px solid #fff;
            border-left: 0;
            border-bottom: 0;
            transition: transform 0.3s ease;
        }

        .scroll-button.prev {
            left: 0;
            background: linear-gradient(90deg, 
                rgba(0, 0, 0, 0.7) 0%,
                rgba(0, 0, 0, 0) 100%);
        }

        .scroll-button.next {
            right: 0;
            background: linear-gradient(90deg, 
                rgba(0, 0, 0, 0) 0%,
                rgba(0, 0, 0, 0.7) 100%);
        }

        .scroll-button.prev::before {
            transform: rotate(-135deg);
        }

        .scroll-button.next::before {
            transform: rotate(45deg);
        }

        .movie-row-container:hover .scroll-button {
            opacity: 1;
        }

        .scroll-button:hover {
            opacity: 1;
            background: linear-gradient(90deg, 
                rgba(0, 0, 0, 0.8) 0%,
                rgba(0, 0, 0, 0.6) 100%);
        }

        .scroll-button:hover::before {
            transform: scale(1.2) rotate(-135deg); /* For prev button */
        }

        .scroll-button.next:hover::before {
            transform: scale(1.2) rotate(45deg); /* For next button */
        }

        .scroll-button.hidden {
            display: none;
        }

        .ribbon {
            position: absolute;
            bottom: 0;
            width: 100%;
            background-color: #e50914;
            color: white;
            text-align: center;
            padding: 5px 0;
            font-size: 14px;
            font-weight: bold;
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

        .modal-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
        }

        .modal-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.7);
            width: 850px;
            max-width: 90%;
            background-color: #181818;
            border-radius: 6px;
            overflow: hidden;
            transition: transform 0.3s ease-in-out;
        }

        .modal.active {
            display: block;
            opacity: 1;
        }

        .modal.active .modal-container {
            transform: translate(-50%, -50%) scale(1);
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid rgba(255, 255, 255, 0.7);
            color: white;
            font-size: 18px;
            cursor: pointer;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .close-modal:hover {
            border-color: white;
            background: rgba(0, 0, 0, 0.9);
        }

        .modal-header {
            position: relative;
            height: 480px;
            background-size: cover;
            background-position: center top;
        }

        .modal-header-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 30px;
            background: linear-gradient(transparent, rgba(0,0,0,0.9) 40%, #181818);
        }

        .modal-info {
            padding: 30px;
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 30px;
        }

        .modal-poster {
            width: 200px;
            border-radius: 4px;
        }

        .movie-meta {
            display: flex;
            gap: 20px;
            margin: 15px 0;
            font-size: 14px;
            color: #a3a3a3;
        }

        .movie-info {
            color: #a3a3a3;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .modal-details p {
            margin-bottom: 10px;
            color: #a3a3a3;
        }

        .modal-details strong {
            color: white;
        }

        .modal-title {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .watch-now-btn {
            background-color: #e50914;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin-top: 15px;
            transition: background-color 0.2s;
        }

        .watch-now-btn:hover {
            background-color: #f40612;
        }

        footer {
            background-color: #141414;
            color: #a3a3a3;
            padding: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            font-size: 14px;
        }

        .footer-links {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .footer-links a {
            color: #a3a3a3;
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-links a:hover {
            color: white;
        }

        .copyright {
            font-size: 12px;
        }

        .dmca-notice {
            font-size: 12px;
            margin-top: 20px;
        }

        .add-to-list-btn {
            background-color: rgba(255, 255, 255, 0.1);
            border: 2px solid white;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
            transition: all 0.3s;
            margin-top: -9px;
        }

        .add-to-list-btn .remove-text {
            display: none;
        }

        .add-to-list-btn.added .add-text {
            display: none;
        }

        .add-to-list-btn.added .remove-text {
            display: inline;
        }

        .add-to-list-btn.added {
            background-color: white;
            color: black;
        }

        .profiles-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #141414;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .profiles-overlay::after {
            content: "Combining Netflix and Disney+ for the Ultimate Experience";
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-style: italic;
            color: rgba(255, 255, 255, 0.3);
            font-size: 12px;
        }

        .profiles-title {
            font-size: 3.5vw;
            color: #fff;
            margin-bottom: 30px;
        }

        .profiles-container {
            display: flex;
            flex-wrap: nowrap; /* Single row of avatars */
            overflow-x: auto; /* Enable horizontal scrolling */
            gap: 30px; /* Space between profiles */
            padding: 10px 20px;
            max-width: 80%; /* Limit width for better appearance */
            justify-content: start; /* Align items to the left */
        }

        .profiles-container::-webkit-scrollbar {
            height: 8px; /* Adjust scrollbar height */
        }

        .profiles-container::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3); /* Subtle scrollbar */
            border-radius: 4px;
        }

        .profiles-container::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5); /* Highlighted on hover */
        }

        .profile {
            cursor: pointer;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: transform 0.3s ease;
            margin: 10px;
        }

        .profile:hover {
            transform: scale(1.1);
        }

        .profile-avatar {
            width: 150px;
            height: 150px;
            border-radius: 4px;
            margin-bottom: 10px;
            border: 3px solid transparent;
        }

        .profile:hover .profile-avatar {
            border-color: #fff; /* Keep the white border on hover */
            border-radius: 50%; /* Make the border circular */
            transition: border-radius 0.3s ease, transform 0.3s ease; /* Add smooth transition for the hover effect */
        }

        .profile-name {
            color: grey;
            font-size: 1.2em;
            text-align: center;
        }

        .profile:hover .profile-name {
            color: #fff;
        }

        .add-profile-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            margin-top: 10px;
        }

        .add-profile-icon {
            width: 150px;
            height: 150px;
            border-radius: 4px;
            background: #141414;
            border: 1px solid grey;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 5em;
            color: grey;
            margin-bottom: 10px;
        }

        .add-profile-btn:hover .add-profile-icon {
            border-color: #fff;
            color: #fff;
        }

        .add-profile-btn:hover .profile-name {
            color: #fff;
        }

        /* Profile Creation Modal */
        .profile-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.85);
            padding: 30px;
            border-radius: 4px;
            z-index: 2001;
            display: none;
        }

        .profile-modal input {
            padding: 10px;
            margin: 10px 0;
            width: 100%;
            background: #333;
            border: none;
            color: #fff;
        }

        .profile-modal button {
            padding: 10px 20px;
            margin: 10px 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .profile-modal button.save {
            background: #e50914;
            color: #fff;
        }

        .profile-modal button.cancel {
            background: transparent;
            border: 1px solid #fff;
            color: #fff;
        }

        .edit-profiles-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #e50914;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .edit-profiles-btn:hover {
            background-color: #f40612;
        }

        .avatar-selection {
            display: flex;
            flex-direction: column; /* Stack title above gallery */
            align-items: center;
            margin: 20px 0;
        }

        .avatar-title {
            font-size: 1.2em;
            color: white;
            margin-bottom: 10px; /* Space between title and avatars */
            text-align: center;
        }

        .avatar-option {
            width: 80px; /* Adjust size as needed */
            height: 80px;
            border-radius: 4px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: transform 0.3s, border-color 0.3s;
        }

        .avatar-option:hover {
            border-color: white;
            transform: scale(1.1);
        }

        @media (max-width: 768px) {
            /* Adjust profile modal for smaller screens */
            .profile-modal {
                width: 90%;
                max-width: 400px;
                overflow: hidden;
                display: flex;
                flex-direction: column;
                justify-content: space-between;
                height: 90vh; /* Take up most of the viewport */
                box-sizing: border-box;
            }

            /* Restrict avatar gallery to a scrollable area */
            .avatar-selection {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 10px;
                max-height: 50%; /* Restrict height to leave space for input and buttons */
                overflow-y: auto; /* Enable vertical scrolling */
                padding: 10px;
                border: 1px solid #333; /* Optional: Add a border to distinguish this area */
            }

            /* Make avatars more compact */
            .avatar-option {
                width: 60px;
                height: 60px;
            }

            /* Ensure text box and buttons are visible */
            .profile-modal input,
            .profile-modal button {
                margin: 10px 0;
                width: 100%;
            }

            /* Sticky title for the avatar gallery */
            .avatar-title {
                position: sticky;
                top: 0;
                background: rgba(0, 0, 0, 0.8);
                padding: 10px;
                width: 100%;
                text-align: center;
                z-index: 10;
            }

            /* Adjust profile container on smaller screens */
            .profiles-container {
                flex-direction: column;
                gap: 15px;
            }

            /* Slightly reduce avatar size on "Who's Watching" screen */
            .profile-avatar {
                width: 100px;
                height: 100px;
            }
        }

        @media screen and (max-width: 1366px) {
            .modal-container {
                width: 100%;
                height: 100%;
                max-width: none;
                position: fixed;
                top: 0;
                left: 0;
                transform: none;
                border-radius: 0;
                overflow-y: auto;
            }

            .modal.active .modal-container {
                transform: none;
            }

            .modal-header {
                height: 40vh; /* Adjust height for smaller screens */
            }

            .modal-info {
                grid-template-columns: 150px 1fr; /* Smaller poster width */
                gap: 20px;
                padding: 20px;
            }

            .modal-poster {
                width: 150px; /* Smaller poster */
            }

            /* Prevent body scrolling when modal is open */
            body.modal-open {
                overflow: hidden;
                position: fixed;
                width: 100%;
            }
        }

        /*4-digit Pins*/

        .lock-icon {
            margin-left: 5px;
            font-size: 14px;
            color: #e50914;
        }

        .pin-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 30px;
            border-radius: 8px;
            z-index: 2002;
            display: none;
            width: 300px;
            text-align: center;
        }

        .pin-input {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .pin-digit {
            width: 40px;
            height: 40px;
            background: #333;
            border: none;
            border-radius: 4px;
            color: white;
            font-size: 20px;
            text-align: center;
        }

        .pin-message {
            color: #e50914;
            margin-top: 10px;
            font-size: 14px;
            min-height: 20px;
        }

        .set-pin-btn {
            background: transparent;
            border: 1px solid white;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }

        .set-pin-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .remove-pin-btn {
            background: #e50914;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }

        .profile-actions {
            display: none; /* Hide by default */
            gap: 10px;
            margin-top: 10px;
        }

        .profile[data-editing="true"] .profile-actions {
            display: flex;
        }

        .profile-actions button {
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .delete-profile-btn {
            background: #e50914;
            color: white;
            border: none;
        }

        .set-pin-btn {
            background: transparent;
            border: 1px solid white;
            color: white;
        }

        .set-pin-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .delete-profile-btn:hover {
            background: #f40612;
        }

        .lock-icon {
            margin-left: 5px;
            font-size: 14px;
        }

        .pin-ok-btn {
            background: #e50914;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }

        .pin-ok-btn:hover {
            background: #f40612;
        }

        /* Mobile Navigation Styles */
        .burger-menu {
            display: none;
            cursor: pointer;
            padding: 10px;
        }

        .burger-menu div {
            width: 25px;
            height: 3px;
            background-color: white;
            margin: 5px 0;
            transition: 0.4s;
        }

        @media screen and (max-width: 768px) {
            .burger-menu {
                display: block;
            }

            .nav-links {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                width: 100%;
                background-color: #141414;
                padding: 20px;
                flex-direction: column;
                align-items: center;
                gap: 20px;
            }

            .nav-links.active {
                display: flex;
            }

            .nav-links a {
                margin: 0 !important;
            }

            nav {
                justify-content: space-between;
            }

                .featured-content img {
                display: none; /* Hide the movie logo */
            }
        }

        .profile-menu {
            position: relative;
            display: flex;
            align-items: center; /* This helps align items vertically */
        }

        .profile-icon {
            width: 32px;
            height: 32px;
            border-radius: 4px;
            cursor: pointer;
        }

        .profile-dropdown {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            padding: 10px;
            min-width: 200px;
        }

        .profile-menu:hover .profile-dropdown {
            display: block;
        }

        .logout-btn {
            width: 100%;
            padding: 8px;
            background: #e50914;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }

        .search-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #141414;
            z-index: 2001;
            display: none;
            padding: 20px;
        }

        .search-container.active {
            display: block;
        }

        .search-box {
            width: 100%;
            max-width: 720px;
            margin: 60px auto 20px;
            padding: 12px 40px 12px 12px;
            font-size: 24px;
            background: transparent;
            border: none;
            border-bottom: 2px solid rgba(255, 255, 255, 0.5);
            color: white;
            transition: border-color 0.3s;
        }

        .search-box:focus {
            outline: none;
            border-bottom-color: white;
        }

        .search-results {
            max-width: 720px;
            margin: 0 auto;
            max-height: calc(100% - 120px);
            overflow-y: auto;
            padding: 20px 0;
        }

        .search-result-item {
            padding: 15px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .search-result-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .search-result-item img {
            width: 100px;
            height: 150px;
            object-fit: cover;
            margin-right: 20px;
        }

        .search-result-item .title {
            color: white;
            font-size: 18px;
        }

        .no-results {
            padding: 30px;
            color: #999;
            text-align: center;
            font-size: 18px;
        }

        .close-search {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            background: none;
            border: none;
            font-size: 32px;
            cursor: pointer;
            padding: 10px;
        }

        .search-icon {
            width: 20px; /* Adjust size as needed */
            height: 20px;
            opacity: 0.7;
            cursor: pointer;
            transition: opacity 0.2s;
            margin-right: 15px;
            filter: invert(1); /* Makes the icon white */
        }

        .search-icon:hover {
            opacity: 1;
        }

        .build-number {
            position: fixed;
            bottom: 10px;
            left: 10px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.5);
            z-index: 1000;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="profiles-overlay" id="profilesOverlay">
        <h1 class="profiles-title">Chi ci Guarda?</h1>
        <button id="editProfilesBtn" class="edit-profiles-btn" onclick="toggleEditProfiles()">Modifica dei Profili</button>
        <div class="profiles-container" id="profilesContainer">
            <!-- Profiles will be added dynamically here -->
        </div>
    </div>    
    
    <div class="profile-modal" id="profileModal">
        <h2>Crea Profilo</h2>
        <input type="text" id="profileName" placeholder="Name">
        <div class="avatar-selection">
            <h3 class="avatar-title">Scegliere l'Avatar</h3>
            <div id="avatarGallery"></div>
        </div>
        <button class="save" onclick="createProfile()">Risparmiare</button>
        <button class="cancel" onclick="hideProfileModal()">Annullamento</button>
    </div>
    
    <div class="pin-modal" id="pinModal">
        <h2 id="pinModalTitle">Inserire il PIN</h2>
        <div class="pin-input">
            <input type="password" maxlength="1" class="pin-digit" />
            <input type="password" maxlength="1" class="pin-digit" />
            <input type="password" maxlength="1" class="pin-digit" />
            <input type="password" maxlength="1" class="pin-digit" />
        </div>
        <div class="pin-message" id="pinMessage"></div>
        <button class="pin-ok-btn" id="pinOkBtn">OK</button>
        <button class="set-pin-btn" id="setPinBtn" style="display: none;">Impostare il PIN</button>
        <button class="remove-pin-btn" id="removePinBtn" style="display: none;">Rimuovere il PIN</button>
    </div>
    
    <header>
        <nav>
            <div class="nav-left">
                <a href="index.html" class="logo">BroFlix</a>
                <div class="burger-menu" onclick="toggleMenu()">
                    <div></div>
                    <div></div>
                    <div></div>
                </div>
                <div class="nav-links">
                    <a href="#coming">Prossimamente</a>
                    <a href="#my-list">Il mio Elenco</a>
                    <a href="../contact.html">Contatto</a>
                    <a href="https://drive.google.com/file/d/1PCgQfVZ0HP4om53T-sdVSz5pTDCttI6f/view?usp=sharing">Applicazione Android</a>
                    <a href="https://broflix-blog.pages.dev/">Blog</a>
                    <a href="https://broflix-blog.pages.dev">English Version</a>
                </div>
            </div>
            <div class="nav-right">
                <img src="../search.png" class="search-icon" onclick="openMobileSearch()" alt="Search">
                <div class="profile-menu">
                    <img id="profileIcon" class="profile-icon" src="" alt="">
                    <div class="profile-dropdown">
                        <div id="profilesList"></div>
                        <button onclick="logout()" class="logout-btn">Esci</button>
                    </div>
                </div>
            </div>            
        </nav>
    </header>

    <div class="search-container">
        <button class="close-search" onclick="closeMobileSearch()">✕</button>
        <input type="text" class="search-box" placeholder="Titoli di ricerca...">
        <div class="search-results"></div>
    </div>    

    <section class="featured">
        <div class="featured-image"></div>
        <div class="featured-content">
            <img src="https://image.tmdb.org/t/p/original/bWaWVbTrPbrzE5kNWKI0P4zUASV.png" style="width: 400px; margin-bottom: 30px;">
            <a href="movies/the-christmas-chronicles-part-two" class="watch-button">
                <img src="../play.png" alt="Play">
                Guarda Ora
            </a>            
        </div>
    </section>

    <section class="movie-section">
        <h2><span style="color: #e50914;">Novità</span> su BroFlix</h2>
        <div class="movie-row-container">
            <button class="scroll-button prev hidden"></button>
            <div class="movie-row" id="new-on-broflix">
                <div class="movie-card" data-movie-id="1" onclick="openModal(1)">
                    <img src="https://image.tmdb.org/t/p/original/oRe4eebpmzsxc1ECTR3l4QZtktM.jpg">
                    <div class="ribbon">Ora Disponibile!</div>
                </div>
                <div class="movie-card" data-movie-id="2" onclick="openModal(2)">
                    <img src="https://image.tmdb.org/t/p/original/lZmfUBIKWNQS7KGyRhwFDXvECGM.jpg">
                    <div class="ribbon">Ora Disponibile!</div>
                </div>
            </div>
            <button class="scroll-button next"></button>
        </div>
    </section>

    <section class="movie-section" id="my-list">
        <h2>Il mio Elenco</h2>
        <div class="movie-row-container">
            <button class="scroll-button prev" style="display: block;"></button>
            <div class="movie-row" id="my-list-row">
                <!-- Movies will be added here dynamically -->
            </div>
            <button class="scroll-button next" style="display: block;"></button>
        </div>
    </section>

    <section class="movie-section">
        <h2>Ora in Streaming</h2>
        <div class="movie-row-container">
            <button class="scroll-button prev hidden"></button>
            <div class="movie-row" id="now-streaming">
                <div class="movie-card" data-movie-id="1" onclick="openModal(1)">
                    <img src="https://image.tmdb.org/t/p/original/oRe4eebpmzsxc1ECTR3l4QZtktM.jpg">
                    <div class="ribbon">Ora Disponibile!</div>
                </div>
                <div class="movie-card" data-movie-id="2" onclick="openModal(2)">
                    <img src="https://image.tmdb.org/t/p/original/lZmfUBIKWNQS7KGyRhwFDXvECGM.jpg">
                    <div class="ribbon">Ora Disponibile!</div>
                </div>
            </div>
            <button class="scroll-button next"></button>
        </div>
    </section>

    <section class="movie-section">
        <h2>Spettacoli Televisivi</h2>
        <div class="movie-row-container">
            <button class="scroll-button prev hidden"></button>
            <div class="movie-row" id="series">
                
            </div>
            <button class="scroll-button next"></button>
        </div>
    </section>

    <section class="movie-section">
        <h2>Collezioni</h2>
        <div class="movie-row-container">
            <button class="scroll-button prev hidden"></button>
            <div class="movie-row" id="collections">
                
            </div>
            <button class="scroll-button next"></button>
        </div>
    </section>    

    <section class="movie-section">
        <h2>Eventi dal Vivo</h2>
        <div class="movie-row-container">
            <button class="scroll-button prev hidden"></button>
            <div class="movie-row" id="live-events">
            </div>
            <button class="scroll-button next"></button>
        </div>
    </section>

    <section class="movie-section" id="coming">
        <h2>Prossimamente</h2>
        <div class="movie-row-container">
            <button class="scroll-button prev hidden"></button>
            <div class="movie-row" id="coming-soon">
                
            </div>
            <button class="scroll-button next"></button>
        </div>
    </section>

    <!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals -->
    <!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals -->
    <!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals -->
    <!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals -->
    <!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals -->
    <!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals -->
    <!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals -->
    <!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals -->
    <!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals -->
    <!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals -->
    <!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals -->
    <!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals -->
    <!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals -->
    <!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals -->
    <!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals -->
    <!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals -->
    <!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals -->
    <!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals -->
    <!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals -->
    <!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals -->
    <!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals --><!-- Modals -->


    <div class="modal" id="movieModal1">
        <div class="modal-background"></div>
        <div class="modal-container">
            <button class="close-modal" onclick="closeModal(1)">✕</button>
            
            <div class="modal-header" style="background-image: url('https://image.tmdb.org/t/p/original/vUbWBVHngojXOu1kBgH6xFkZZTA.jpg')">
                <div class="modal-header-content">
                    <h1 class="modal-title">Qualcuno salvi il Natale</h1>
                    <div class="movie-meta">
                        <span>2018</span>
                        <span>1h 44m</span>
                        <span>Commedia</span>
                        <span>PG</span>
                        <button class="add-to-list-btn" onclick="toggleMyList(1)">
                            <span class="add-text">+ My List</span>
                            <span class="remove-text">✓ Added</span>
                        </button>
                    </div>
                    <a href="/movies/the-christmas-chronicles" class="watch-button">
                        <img src="../play.png" alt="Play">
                        Guarda Ora
                    </a>
                </div>
            </div>

            <div class="modal-info">
                <img src="https://image.tmdb.org/t/p/original/hieu1RcRHUarLaiL4mpq32ZzlhW.jpg" class="modal-poster">
                <div class="modal-details">
                    <p class="movie-info">
                        Kate e Teddy, un fratello e una sorella, decidono di filmare di nascosto Babbo Natale, mettendosi in una situazione che la maggior parte dei bambini possono solo sognarsi. Dopo essersi appostati per sorprendere l'arrivo di Babbo Natale, si intrufolano nella sua slitta e provocano un incidente, rischiando di far saltare il Natale. Durante questa incredibile notte, Kate e Teddy, insieme a Babbo Natale (in una versione davvero inedita) e ai suoi elfi, devono salvare il Natale prima che sia troppo tardi.
                    </p>
                    <div>
                        <p><strong>Direttore:</strong> Clay Kaytis</p>
                        <p><strong>Il getto:</strong> Darby Camp, Judah Lewis, Kurt Russell, Martin Roach, Lamorne Morris, Kimberly Williams-Paisley, Oliver Hudson</p>
                        <p><strong>Genere:</strong> Commedia, Avventura, Famiglia, Fantasy</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="movieModal2">
        <div class="modal-background"></div>
        <div class="modal-container">
            <button class="close-modal" onclick="closeModal(2)">✕</button>
            
            <div class="modal-header" style="background-image: url('https://image.tmdb.org/t/p/original/bkkPz0dfr42LeMSBhqRHMf4X73H.jpg')">
                <div class="modal-header-content">
                    <h1 class="modal-title">Qualcuno salvi il Natale 2</h1>
                    <div class="movie-meta">
                        <span>2020</span>
                        <span>1h 52m</span>
                        <span>Famiglia</span>
                        <span>PG</span>
                        <button class="add-to-list-btn" onclick="toggleMyList(2)">
                            <span class="add-text">+ My List</span>
                            <span class="remove-text">✓ Added</span>
                        </button>
                    </div>
                    <a href="/movies/the-christmas-chronicles-part-two" class="watch-button">
                        <img src="../play.png" alt="Play">
                        Guarda Ora
                    </a>
                </div>
            </div>

            <div class="modal-info">
                <img src="https://image.tmdb.org/t/p/original/jrjvIF4SksEfGLA96v9H9fuu06B.jpg" class="modal-poster">
                <div class="modal-details">
                    <p class="movie-info">
                        Kate Pierce è ormai un'adolescente cinica che ritrova inaspettatamente Babbo Natale quando un piantagrane misterioso minaccia di cancellare per sempre la festa.
                    </p>
                    <div>
                        <p><strong>Direttore:</strong> Chris Columbus</p>
                        <p><strong>Il getto:</strong> Kurt Russell, Goldie Hawn, Darby Camp, Julian Dennison, Jahzir Bruno</p>
                        <p><strong>Genere:</strong> Famiglia, Fantasy, Avventura, Commedia</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-links">
            <a href="#">Casa</a>
            <a href="directory-it.txt">Elenco dei film</a>
        </div>
        <div class="copyright">
            &copy; 2024 BroFlix. Tutti i diritti riservati.
        </div>
        <div class="dmca-notice">
            Questo sito web utilizza contenuti provenienti da varie fonti terze. Non possediamo né ospitiamo alcuno dei contenuti visualizzati su questo sito. Eventuali reclami relativi a DMCA o ad altri diritti d'autore devono essere indirizzati ai rispettivi proprietari dei contenuti.
        </div>
    </footer>

    <script>
        window.addEventListener('scroll', () => {
            const header = document.querySelector('header');
            if (window.scrollY > 50) {
                header.style.backgroundColor = '#141414';
            } else {
                header.style.backgroundColor = 'transparent';
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            const containers = document.querySelectorAll('.movie-row-container');
            
            containers.forEach(container => {
                const row = container.querySelector('.movie-row');
                const prevBtn = container.querySelector('.scroll-button.prev');
                const nextBtn = container.querySelector('.scroll-button.next');
                let scrollPosition = 0;
                
                function getScrollDistance() {
                    const movieCard = row.querySelector('.movie-card');
                    if (movieCard) {
                        // Get the movie card width plus the gap (15px)
                        return movieCard.offsetWidth + 15;
                    }
                    return 300; // fallback value
                }

                nextBtn.addEventListener('click', () => {
                    const maxScroll = row.scrollWidth - container.clientWidth;
                    const scrollDistance = getScrollDistance();
                    scrollPosition = Math.min(scrollPosition + scrollDistance, maxScroll);
                    row.style.transform = `translateX(-${scrollPosition}px)`;
                    updateButtons();
                });

                prevBtn.addEventListener('click', () => {
                    const scrollDistance = getScrollDistance();
                    scrollPosition = Math.max(scrollPosition - scrollDistance, 0);
                    row.style.transform = `translateX(-${scrollPosition}px)`;
                    updateButtons();
                });

                function updateButtons() {
                    prevBtn.classList.toggle('hidden', scrollPosition === 0);
                    const maxScroll = row.scrollWidth - container.clientWidth;
                    nextBtn.classList.toggle('hidden', scrollPosition >= maxScroll);
                }

                updateButtons();
                window.addEventListener('resize', updateButtons);
            });
        });

        function openModal(movieId) {
            const modal = document.getElementById(`movieModal${movieId}`);
            if (modal) {
                modal.style.display = 'block';
                document.body.classList.add('modal-open'); // Add class to disable scrolling
                modal.offsetHeight; // Force reflow
                modal.classList.add('active');

                // Sync the "Add to List" button
                const addToListBtn = modal.querySelector('.add-to-list-btn');
                if (addToListBtn) {
                    const isAdded = myList.includes(movieId);
                    addToListBtn.classList.toggle('added', isAdded);
                    updateButtonText(addToListBtn, isAdded);
                }
            }
        }

        function closeModal(movieId) {
            const modal = document.getElementById(`movieModal${movieId}`);
            if (modal) {
                modal.classList.remove('active');
                setTimeout(() => {
                    modal.style.display = 'none';
                    document.body.classList.remove('modal-open'); // Remove class to re-enable scrolling
                }, 300);
            }
        }

        window.onclick = function(event) {
            if (event.target.classList.contains('modal-background')) {
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => {
                    modal.classList.remove('active');
                    setTimeout(() => {
                        modal.style.display = 'none';
                        document.body.style.overflow = 'auto';
                    }, 300);
                });
            }
        };

        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => {
                    modal.classList.remove('active');
                    setTimeout(() => {
                        modal.style.display = 'none';
                        document.body.style.overflow = 'auto';
                    }, 300);
                });
            }
        });

        //List

        const myList = JSON.parse(localStorage.getItem('myList')) || [];

        function toggleMyList(movieId) {
            const index = myList.indexOf(movieId);
            const btn = document.querySelector(`#movieModal${movieId} .add-to-list-btn`);
            
            if (index === -1) {
                // Add to list
                myList.push(movieId);
                btn.classList.add('added');
            } else {
                // Remove from list
                myList.splice(index, 1);
                btn.classList.remove('added');
            }
            
            localStorage.setItem('myList', JSON.stringify(myList));
            updateMyListSection();
        }

        function updateMyListSection() {
            const myListRow = document.getElementById('my-list-row');
            
            if (myList.length === 0) {
                // Display message when list is empty
                myListRow.innerHTML = '<div style="width: 100%; text-align: center; color: #666; padding: 20px;">Nothing to show here yet...</div>';
                
                // Hide scroll buttons when empty
                const container = document.querySelector('#my-list .movie-row-container');
                const prevBtn = container.querySelector('.scroll-button.prev');
                const nextBtn = container.querySelector('.scroll-button.next');
                prevBtn.style.display = 'none';
                nextBtn.style.display = 'none';
                return;
            }
            
            // Rest of your existing code for when there are items in the list
            myListRow.innerHTML = '';
            
            myList.forEach(movieId => {
                const originalCard = document.querySelector(`[data-movie-id="${movieId}"]`);
                if (originalCard) {
                    const clone = originalCard.cloneNode(true);
                    myListRow.appendChild(clone);
                }
            });

            // Show/hide scroll buttons based on content
            const container = document.querySelector('#my-list .movie-row-container');
            const row = myListRow;
            const prevBtn = container.querySelector('.scroll-button.prev');
            const nextBtn = container.querySelector('.scroll-button.next');
            
            // Reset scroll position
            let scrollPosition = 0;
            row.style.transform = 'translateX(0)';

            // Show/hide buttons based on content width
            const hasOverflow = row.scrollWidth > container.clientWidth;
            prevBtn.style.display = hasOverflow ? 'block' : 'none';
            nextBtn.style.display = hasOverflow ? 'block' : 'none';

            // Clear previous event listeners
            prevBtn.replaceWith(prevBtn.cloneNode(true));
            nextBtn.replaceWith(nextBtn.cloneNode(true));

            // Get fresh references after replacing elements
            const newPrevBtn = container.querySelector('.scroll-button.prev');
            const newNextBtn = container.querySelector('.scroll-button.next');

            // Add new event listeners
            newNextBtn.addEventListener('click', () => {
                const maxScroll = row.scrollWidth - container.clientWidth;
                scrollPosition = Math.min(scrollPosition + 1000, maxScroll);
                row.style.transform = `translateX(-${scrollPosition}px)`;
                updateButtons();
            });

            newPrevBtn.addEventListener('click', () => {
                scrollPosition = Math.max(scrollPosition - 1000, 0);
                row.style.transform = `translateX(-${scrollPosition}px)`;
                updateButtons();
            });

            function updateButtons() {
                newPrevBtn.classList.toggle('hidden', scrollPosition === 0);
                const maxScroll = row.scrollWidth - container.clientWidth;
                newNextBtn.classList.toggle('hidden', scrollPosition >= maxScroll);
            }

            updateButtons();
        }

        // Initialize My List on page load
        document.addEventListener('DOMContentLoaded', () => {
            updateMyListSection();
            
            // Update "Add to List" buttons state
            myList.forEach(movieId => {
                const btn = document.querySelector(`#movieModal${movieId} .add-to-list-btn`);
                if (btn) btn.classList.add('added');
            });
        });

        // Profile Management
        let currentProfile = null;

        function initializeProfiles() {
            // Get profiles from localStorage or default to an empty array
            let profiles = JSON.parse(localStorage.getItem('profiles')) || [];

            // Only show the profiles overlay
            document.getElementById('profilesOverlay').style.display = 'flex';
            document.body.style.overflow = 'hidden';
            
            // Update the profiles display
            updateProfilesDisplay();
        }

        function updateProfilesDisplay() {
            const profiles = JSON.parse(localStorage.getItem('profiles')) || [];
            const container = document.getElementById('profilesContainer');
            
            // Clear existing profiles
            container.innerHTML = '';
            
            // Add existing profiles
            profiles.forEach(profile => {
                const profileElement = document.createElement('div');
                profileElement.className = 'profile';
                profileElement.setAttribute('data-profile-id', profile.id);
                profileElement.onclick = !isEditingProfiles ? () => selectProfile(profile) : null;

                profileElement.innerHTML = `
                    <img class="profile-avatar" src="${profile.avatar}" alt="${profile.name}">
                    <span class="profile-name">${profile.name}</span>
                `;

                container.appendChild(profileElement);
            });

            // Add the "Add Profile" button
            const addProfileBtn = document.createElement('div');
            addProfileBtn.className = 'add-profile-btn';
            addProfileBtn.onclick = () => showProfileModal(); // Use function call instead of direct reference
            addProfileBtn.innerHTML = `
                <div class="add-profile-icon">+</div>
                <span class="profile-name">Add Profile</span>
            `;
            container.appendChild(addProfileBtn);

            if (isEditingProfiles) {
                enableProfileEditing();
            }
        }

        function showProfileModal() {
            document.getElementById('profileModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function hideProfileModal() {
            document.getElementById('profileModal').style.display = 'none';
            // Only keep overflow hidden if the profiles overlay is still visible
            if (document.getElementById('profilesOverlay').style.display === 'flex') {
                document.body.style.overflow = 'hidden';
            } else {
                document.body.style.overflow = '';
            }
        }

        function createProfile() {
            const name = document.getElementById('profileName').value.trim();
            if (name) {
                const profiles = JSON.parse(localStorage.getItem('profiles')) || [];
                const newProfile = {
                    id: Date.now(),
                    name: name,
                    myList: []
                };
                profiles.push(newProfile);
                localStorage.setItem('profiles', JSON.stringify(profiles));
                hideProfileModal();
                updateProfilesDisplay();
            }
        }

        function selectProfile(profile) {
            if (profile.pin) {
                showPinModal('verify', profile.id);
                const inputs = document.querySelectorAll('.pin-digit');
                const okButton = document.getElementById('pinOkBtn');
                
                // Function to verify PIN
                const verifyPin = () => {
                    const enteredPin = getEnteredPin();
                    if (enteredPin === profile.pin) {
                        document.getElementById('pinModal').style.display = 'none';
                        activateProfile(profile);
                    } else {
                        document.getElementById('pinMessage').textContent = 'Incorrect PIN';
                        inputs.forEach(input => input.value = '');
                        inputs[0].focus();
                    }
                };

                // Automatic verification when all digits are entered
                inputs[3].addEventListener('keyup', (e) => {
                    if (e.key >= 0 && e.key <= 9) {
                        verifyPin();
                    }
                });

                // Manual verification when OK button is clicked
                okButton.onclick = verifyPin;

            } else {
                activateProfile(profile);
            }
        }

        function syncAddToListButtons() {
            const allAddButtons = document.querySelectorAll('.add-to-list-btn');

            allAddButtons.forEach(button => {
                const movieCard = button.closest('[data-movie-id]');
                if (movieCard) {
                    const movieId = parseInt(movieCard.dataset.movieId, 10);
                    const isAdded = myList.includes(movieId);

                    button.classList.toggle('added', isAdded);
                    updateButtonText(button, isAdded);
                }
            });
        }

        // Modify the toggleMyList function to work with profiles
        function toggleMyList(movieId) {
            if (!currentProfile) return; // Ensure a profile is selected

            const index = myList.indexOf(movieId);
            const btn = document.querySelector(`#movieModal${movieId} .add-to-list-btn`);
            
            if (index === -1) {
                // Add to list
                myList.push(movieId);
                btn.classList.add('added');
            } else {
                // Remove from list
                myList.splice(index, 1);
                btn.classList.remove('added');
            }

            // Update button text
            updateButtonText(btn, index === -1);

            // Update the current profile's list in localStorage
            const profiles = JSON.parse(localStorage.getItem('profiles')) || [];
            const profileIndex = profiles.findIndex(p => p.id === currentProfile.id);
            if (profileIndex !== -1) {
                profiles[profileIndex].myList = myList;
                localStorage.setItem('profiles', JSON.stringify(profiles));
            }

            updateMyListSection();
        }

        // Helper function to update button text based on the current state
        function updateButtonText(button, isAdded) {
            if (isAdded) {
                button.querySelector('.add-text').style.display = 'none';
                button.querySelector('.remove-text').style.display = 'inline';
            } else {
                button.querySelector('.add-text').style.display = 'inline';
                button.querySelector('.remove-text').style.display = 'none';
            }
        }

        // Initialize profiles when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            initializeProfiles();
            initializeWithLastProfile();
        });

        // List of avatar image URLs hosted on your server
        const avatarImages = [
            'https://prod-ripcut-delivery.disney-plus.net/v1/variant/disney/EA2AE1BF47B714DEB1B9E050450AB5CF76FF3A7397D69F6B235DAB265123A071/scale?width=300&aspectRatio=1.00&format=png',
            'https://prod-ripcut-delivery.disney-plus.net/v1/variant/disney/2D1BACACD140222501ACB2F3F85A9E13A20469CD1E3EA4ACE2461851D15E888D/scale?width=300&aspectRatio=1.00&format=png',
            'https://prod-ripcut-delivery.disney-plus.net/v1/variant/disney/7AF80638BF5375882B663D6B7613A431D7E5513ECE97A6BB6512F6FD22EC69B4/scale?width=300&aspectRatio=1.00&format=png',
            'https://prod-ripcut-delivery.disney-plus.net/v1/variant/disney/830A63659C4DBEB64FE705A5BEB57823D0F883E321EEC787852D1B59C512013A/scale?width=300&aspectRatio=1.00&format=png',
            'https://prod-ripcut-delivery.disney-plus.net/v1/variant/disney/CD05FF92A733E897568A4DF2C05D279892E1F9D19082F3BB55DE277E5A4BDC0E/scale?width=300&aspectRatio=1.00&format=png',
            'https://prod-ripcut-delivery.disney-plus.net/v1/variant/disney/F73277B06EE997988A5DD3356F145DB4A0D9C82A7656796DB20B93B2D0DC7C79/scale?width=300&aspectRatio=1.00&format=png',
            'https://prod-ripcut-delivery.disney-plus.net/v1/variant/disney/751640804A7E00D762A3C4C9AEE66FB07C53178ACD62703964526177DC1E31FA/scale?width=300&aspectRatio=1.00&format=png',
            'https://prod-ripcut-delivery.disney-plus.net/v1/variant/disney/035666D95D62EEAAE70D11B1C5A1B84AAF97297C022F04C7F6399E4A55A2D068/scale?width=300&aspectRatio=1.00&format=png',
            'https://prod-ripcut-delivery.disney-plus.net/v1/variant/disney/0B1CBFF3F397FF5A8CA180BE6404FFBBF42C5C8408176330CC8AAF43FAB40A0C/scale?width=300&aspectRatio=1.00&format=png',
            'https://prod-ripcut-delivery.disney-plus.net/v1/variant/disney/4A993C424D26F3A4910ADA5551330DE74BED8F6D790363C9E06E0E9B7957D89C/scale?width=300&aspectRatio=1.00&format=png',
            'https://prod-ripcut-delivery.disney-plus.net/v1/variant/disney/C13051D2045FE177C84AE90DE864E20B24E2D9BAA02C425153D9269364562FF2/scale?width=300&aspectRatio=1.00&format=png',
            'https://prod-ripcut-delivery.disney-plus.net/v1/variant/disney/52821BBD6A36902BC6152E2F16A64DFF5AB6759844E06E6A3E4E2DFA59A3C9DE/scale?width=300&aspectRatio=1.00&format=png',
            'https://prod-ripcut-delivery.disney-plus.net/v1/variant/disney/9117E672F6814F42E026235154D3E438A05573222E559F161C14B89ED3A4F65B/scale?width=300&aspectRatio=1.00&format=png',
            'https://prod-ripcut-delivery.disney-plus.net/v1/variant/disney/FE49954B252C628EC809C68832E9137D5926C2085D58A6510F8BBA12933F7B7E/scale?width=300&aspectRatio=1.00&format=png',
            'https://prod-ripcut-delivery.disney-plus.net/v1/variant/disney/E86A0B41FAD9D1E71117EA587A8A3CCE2F90CAEE497C4D589C8D72D9D9EB440A/scale?width=300&aspectRatio=1.00&format=png',
            'https://prod-ripcut-delivery.disney-plus.net/v1/variant/disney/317859BB86DDB612979FF08CAE39011C7BE7A64D7D7ECB952489546AAA239194/scale?width=300&aspectRatio=1.00&format=png',
            'https://prod-ripcut-delivery.disney-plus.net/v1/variant/disney/A70AE42D2F721B8E2F293C57E4BC934607D3DD1305DC4EC4B19D48163C9B68BB/scale?width=300&aspectRatio=1.00&format=png',
            'https://prod-ripcut-delivery.disney-plus.net/v1/variant/disney/0E815741CEFA1CCBBCDFB5546DEC85092537C823100CDED57442D2A5649D263F/scale?width=300&aspectRatio=1.00&format=png',
            'https://prod-ripcut-delivery.disney-plus.net/v1/variant/disney/EA9705B1B18DDFC8DB720708A00151A38351F8459D2F0A0DAB5C9B081F79AEC1/scale?width=300&aspectRatio=1.00&format=png',
            'https://prod-ripcut-delivery.disney-plus.net/v1/variant/disney/BD2FA0F3965617FC515E3CEBD3AD51C00CCFFBF98F96448EFE46B82867FCE542/scale?width=300&aspectRatio=1.00&format=png',
            'https://prod-ripcut-delivery.disney-plus.net/v1/variant/disney/9B9BD428EFE9C3EA7DE723534401B0BD8BD2743647C39839F33F11D1DE0AD2A5/scale?width=300&aspectRatio=1.00&format=png',
            'https://prod-ripcut-delivery.disney-plus.net/v1/variant/disney/58A1E29AEE806CE56D4FB7E902435DD6303E562F23A7F8944DF37F51FF4BC020/scale?width=300&aspectRatio=1.00&format=png',
            'https://prod-ripcut-delivery.disney-plus.net/v1/variant/disney/ACE4F4BFED3DB6029C69C846D1572C3620FF908F0B7AFA387FF22EE65BC53C2E/scale?width=300&aspectRatio=1.00&format=png',
            'https://prod-ripcut-delivery.disney-plus.net/v1/variant/disney/9ED384B20C3A89FC2ED445FD89DFE0A8B7354381D670C8E18F619AF33902F712/scale?width=300&aspectRatio=1.00&format=png',
            'https://prod-ripcut-delivery.disney-plus.net/v1/variant/disney/2A53CC399D20855B67CD7CD3518B3E83C13AD9575340E4178B12CE68ED5BF218/scale?width=300&aspectRatio=1.00&format=png',
            'https://prod-ripcut-delivery.disney-plus.net/v1/variant/disney/6552F370F58E97EFE932B2A8386B441DDE3E5ED179B248C5BA45528B6278E297/scale?width=300&aspectRatio=1.00&format=png',
            'https://prod-ripcut-delivery.disney-plus.net/v1/variant/disney/CD8071968651B5EC425DC55F0BDFCE4877E7EFAFC9616E96F4243C38A940DBA8/scale?width=300&aspectRatio=1.00&format=png',
            'https://prod-ripcut-delivery.disney-plus.net/v1/variant/disney/BA2B0A0DBDAED26E6546A7533238E3F41F811DD1D3B20DF41992D856C64D9CDB/scale?width=300&aspectRatio=1.00&format=png',
            'https://prod-ripcut-delivery.disney-plus.net/v1/variant/disney/912D34995E37BB375284B59F1849F76B9369556D3807BDCADFA8589758169FBA/scale?width=300&aspectRatio=1.00&format=png'
        ];

        let selectedAvatar = null;

        function showProfileModal() {
            const modal = document.getElementById('profileModal');
            const avatarGallery = document.getElementById('avatarGallery');
            
            // Generate avatar selection gallery
            avatarGallery.innerHTML = avatarImages.map(imgUrl => `
                <img src="${imgUrl}" class="avatar-option" 
                    onclick="selectAvatar('${imgUrl}')">
            `).join('');
            
            modal.style.display = 'block';
        }

        function selectAvatar(avatar) {
            selectedAvatar = avatar;
            // Highlight the selected avatar
            document.querySelectorAll('.avatar-option').forEach(img => {
                img.style.border = img.src === avatar ? '3px solid white' : 'none';
            });
        }

        function createProfile() {
            const name = document.getElementById('profileName').value.trim();
            if (name && selectedAvatar) {
                const profiles = JSON.parse(localStorage.getItem('profiles')) || [];
                const newProfile = {
                    id: Date.now(),
                    name: name,
                    avatar: selectedAvatar,
                    myList: []
                };
                profiles.push(newProfile);
                localStorage.setItem('profiles', JSON.stringify(profiles));
                hideProfileModal();
                updateProfilesDisplay();
            } else {
                alert('Please enter a name and select an avatar.');
            }
        }

        //Edit Profiles

        let isEditingProfiles = false;

        function toggleEditProfiles() {
            const editBtn = document.getElementById('editProfilesBtn');
            isEditingProfiles = !isEditingProfiles;

            if (isEditingProfiles) {
                editBtn.textContent = 'Done';
                enableProfileEditing();
            } else {
                editBtn.textContent = 'Edit Profiles';
                disableProfileEditing();
            }
        }

        function deleteProfile(profileId) {
            let profiles = JSON.parse(localStorage.getItem('profiles')) || [];
            profiles = profiles.filter(profile => profile.id !== profileId);
            localStorage.setItem('profiles', JSON.stringify(profiles));
            updateProfilesDisplay();
        }

        function enableProfileEditing() {
            const profiles = JSON.parse(localStorage.getItem('profiles')) || [];
            const container = document.getElementById('profilesContainer');
            
            container.innerHTML = '';
            
            profiles.forEach(profile => {
                const profileElement = document.createElement('div');
                profileElement.className = 'profile';
                profileElement.setAttribute('data-profile-id', profile.id);
                profileElement.setAttribute('data-editing', 'true');
                
                profileElement.innerHTML = `
                    <img class="profile-avatar" src="${profile.avatar}" alt="${profile.name}">
                    <span class="profile-name">
                        ${profile.name}
                        ${profile.pin ? '<span class="lock-icon">🔒</span>' : ''}
                    </span>
                    <div class="profile-actions">
                        <button class="set-pin-btn">${profile.pin ? 'Remove PIN' : 'Set PIN'}</button>
                        <button class="delete-profile-btn">Delete</button>
                    </div>
                `;

                const pinBtn = profileElement.querySelector('.set-pin-btn');
                const deleteBtn = profileElement.querySelector('.delete-profile-btn');

                pinBtn.onclick = (e) => {
                    e.stopPropagation();
                    showPinModal(profile.pin ? 'remove' : 'set', profile.id);
                };

                deleteBtn.onclick = (e) => {
                    e.stopPropagation();
                    deleteProfile(profile.id);
                };

                container.appendChild(profileElement);
            });

            // Add the "Add Profile" button
            const addProfileBtn = document.createElement('div');
            addProfileBtn.className = 'add-profile-btn';
            addProfileBtn.onclick = showProfileModal;
            addProfileBtn.innerHTML = `
                <div class="add-profile-icon">+</div>
                <span class="profile-name">Add Profile</span>
            `;
            container.appendChild(addProfileBtn);
        }

        function disableProfileEditing() {
            updateProfilesDisplay();
        }

        function updateProfilesDisplay() {
            const profiles = JSON.parse(localStorage.getItem('profiles')) || [];
            const container = document.getElementById('profilesContainer');
            
            container.innerHTML = '';
            
            profiles.forEach(profile => {
                const profileElement = document.createElement('div');
                profileElement.className = 'profile';
                profileElement.setAttribute('data-profile-id', profile.id);
                profileElement.onclick = !isEditingProfiles ? () => selectProfile(profile) : null;

                profileElement.innerHTML = `
                    <img class="profile-avatar" src="${profile.avatar}" alt="${profile.name}">
                    <span class="profile-name">${profile.name}</span>
                `;

                container.appendChild(profileElement);
            });

            // Add the "Add Profile" button
            const addProfileBtn = document.createElement('div');
            addProfileBtn.className = 'add-profile-btn';
            addProfileBtn.onclick = showProfileModal;
            addProfileBtn.innerHTML = `
                <div class="add-profile-icon">+</div>
                <span class="profile-name">Add Profile</span>
            `;
            container.appendChild(addProfileBtn);

            if (isEditingProfiles) {
                enableProfileEditing();
            }
        }

        // 4-digit Pins

        function showPinModal(action, profileId) {
            const modal = document.getElementById('pinModal');
            const title = document.getElementById('pinModalTitle');
            const setPinBtn = document.getElementById('setPinBtn');
            const removePinBtn = document.getElementById('removePinBtn');
            const okBtn = document.getElementById('pinOkBtn');
            const inputs = modal.querySelectorAll('.pin-digit');
            const message = document.getElementById('pinMessage');

            // Reset the modal
            inputs.forEach(input => input.value = '');
            message.textContent = '';
            setPinBtn.style.display = 'none';
            removePinBtn.style.display = 'none';
            okBtn.style.display = 'none';

            // Configure modal based on action
            switch(action) {
                case 'set':
                    title.textContent = 'Set PIN';
                    setPinBtn.style.display = 'block';
                    setPinBtn.onclick = () => verifyAndSetPin(profileId);
                    break;
                case 'verify':
                    title.textContent = 'Enter PIN';
                    okBtn.style.display = 'block'; // Only show OK button for verification
                    break;
                case 'remove':
                    title.textContent = 'Enter PIN to Remove';
                    removePinBtn.style.display = 'block';
                    removePinBtn.onclick = () => verifyAndRemovePin(profileId);
                    break;
            }

            modal.style.display = 'block';
            inputs[0].focus();

            // Set up input handling
            setupPinInputs(inputs);
        }

        function setupPinInputs(inputs) {
            inputs.forEach((input, index) => {
                input.addEventListener('keyup', (e) => {
                    if (e.key >= 0 && e.key <= 9) {
                        if (index < inputs.length - 1) {
                            inputs[index + 1].focus();
                        }
                    } else if (e.key === 'Backspace') {
                        if (index > 0) {
                            inputs[index - 1].focus();
                        }
                    }
                });
            });
        }

        function getEnteredPin() {
            const inputs = document.querySelectorAll('.pin-digit');
            return Array.from(inputs).map(input => input.value).join('');
        }

        function verifyAndSetPin(profileId) {
            const pin = getEnteredPin();
            if (pin.length === 4) {
                const profiles = JSON.parse(localStorage.getItem('profiles')) || [];
                const profile = profiles.find(p => p.id === profileId);
                if (profile) {
                    profile.pin = pin;
                    localStorage.setItem('profiles', JSON.stringify(profiles));
                    document.getElementById('pinModal').style.display = 'none';
                    updateProfilesDisplay();
                }
            } else {
                document.getElementById('pinMessage').textContent = 'Please enter a 4-digit PIN';
            }
        }

        function verifyAndRemovePin(profileId) {
            const pin = getEnteredPin();
            const profiles = JSON.parse(localStorage.getItem('profiles')) || [];
            const profile = profiles.find(p => p.id === profileId);
            
            if (profile && profile.pin === pin) {
                delete profile.pin;
                localStorage.setItem('profiles', JSON.stringify(profiles));
                document.getElementById('pinModal').style.display = 'none';
                updateProfilesDisplay();
            } else {
                document.getElementById('pinMessage').textContent = 'Incorrect PIN';
            }
        }

        // Modify your selectProfile function to check for PIN
        function selectProfile(profile) {
            if (profile.pin) {
                showPinModal('verify', profile.id);
                const inputs = document.querySelectorAll('.pin-digit');
                const okBtn = document.getElementById('pinOkBtn');
                
                // Function to verify PIN
                const handlePinVerification = () => {
                    const enteredPin = getEnteredPin();
                    if (enteredPin === profile.pin) {
                        document.getElementById('pinModal').style.display = 'none';
                        activateProfile(profile);
                    } else {
                        document.getElementById('pinMessage').textContent = 'Incorrect PIN';
                        inputs.forEach(input => input.value = '');
                        inputs[0].focus();
                    }
                };

                // Automatic verification when all digits are entered
                inputs[3].addEventListener('keyup', (e) => {
                    if (e.key >= 0 && e.key <= 9) {
                        handlePinVerification();
                    }
                });

                // Manual verification when OK button is clicked
                okBtn.onclick = handlePinVerification;

            } else {
                activateProfile(profile);
            }
        }

        function activateProfile(profile) {
            currentProfile = profile;
            setCookie('lastProfile', profile, 30); // Store for 30 days
            
            // Hide the profiles overlay
            document.getElementById('profilesOverlay').style.display = 'none';
            
            // Reset body overflow and remove any fixed positioning
            document.body.style.overflow = '';
            document.body.style.position = '';
            document.body.style.width = '';
            document.body.style.height = '';
            
            // Update the my list
            myList.length = 0;
            myList.push(...(profile.myList || []));
            updateMyListSection();
            syncAddToListButtons();
            updateProfileIcon(profile);
        }

        function toggleMenu() {
            const navLinks = document.querySelector('.nav-links');
            navLinks.classList.toggle('active');
            
            // Optional: Animate burger menu
            const burgerLines = document.querySelectorAll('.burger-menu div');
            burgerLines[0].style.transform = navLinks.classList.contains('active') ? 
                'rotate(-45deg) translate(-5px, 6px)' : '';
            burgerLines[1].style.opacity = navLinks.classList.contains('active') ? '0' : '1';
            burgerLines[2].style.transform = navLinks.classList.contains('active') ? 
                'rotate(45deg) translate(-5px, -6px)' : '';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal-background')) {
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => {
                    modal.classList.remove('active');
                    setTimeout(() => {
                        modal.style.display = 'none';
                        document.body.style.overflow = 'auto';
                    }, 300);
                });
            }
        };

        //LAST LOG IN FUNCTIONS

        function setCookie(name, value, days) {
            const expires = new Date();
            expires.setTime(expires.getTime() + (days * 24 * 60 * 60 * 1000));
            document.cookie = `${name}=${JSON.stringify(value)};expires=${expires.toUTCString()};path=/`;
        }

        function getCookie(name) {
            const nameEQ = name + "=";
            const ca = document.cookie.split(';');
            for(let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) === 0) {
                    try {
                        return JSON.parse(c.substring(nameEQ.length, c.length));
                    } catch (e) {
                        return null;
                    }
                }
            }
            return null;
        }

        function deleteCookie(name) {
            document.cookie = `${name}=;expires=Thu, 01 Jan 1970 00:00:01 GMT;path=/`;
        }

        function updateProfileIcon(profile) {
            const profileIcon = document.getElementById('profileIcon');
            profileIcon.src = profile.avatar;
            profileIcon.alt = profile.name;
        }

        function logout() {
            deleteCookie('lastProfile');
            location.reload();
        }

        function initializeWithLastProfile() {
            const lastProfile = getCookie('lastProfile');
            if (lastProfile) {
                const profiles = JSON.parse(localStorage.getItem('profiles')) || [];
                const profile = profiles.find(p => p.id === lastProfile.id);
                if (profile) {
                    // Directly activate the profile without PIN verification
                    activateProfile(profile);
                } else {
                    document.getElementById('profilesOverlay').style.display = 'flex';
                }
            } else {
                document.getElementById('profilesOverlay').style.display = 'flex';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const searchBox = document.querySelector('.search-box');
            const searchResults = document.querySelector('.search-results');
            
            const movies = [
                { id: 1, title: "Inside Out 2", poster: "https://www.themoviedb.org/t/p/w600_and_h900_bestv2/vpnVM9B6NMmQpWeZvzLvDESb2QY.jpg" },
                { id: 2, title: "Titanic", poster: "https://www.themoviedb.org/t/p/w600_and_h900_bestv2/9xjZS2rlVxm8SFx8kPC3aIGCOYQ.jpg" },
                { id: 3, title: "Cars", poster: "https://image.tmdb.org/t/p/original/u4G8EkiIBZYx0wEg2xDlXZigTOZ.jpg" },
                { id: 4, title: "Ratatouille", poster: "https://image.tmdb.org/t/p/original/t3vaWRPSf6WjDSamIkKDs1iQWna.jpg" },
                { id: 5, title: "Ted", poster: "https://image.tmdb.org/t/p/original/1QVZXQQHCEIj8lyUhdBYd2qOYtq.jpg" },
                { id: 6, title: "The Christmas Chronicles", poster: "https://image.tmdb.org/t/p/original/5Il2EMSF2KecrUKZPuen6BZmaCP.jpg" },
                { id: 7, title: "Home Alone", poster: "https://image.tmdb.org/t/p/original/onTSipZ8R3bliBdKfPtsDuHTdlL.jpg" },
                { id: 8, title: "Avatar: The Last Airbender", poster: "https://image.tmdb.org/t/p/original/9RQhVb3r3mCMqYVhLoCu4EvuipP.jpg" },
                { id: 9, title: "The Truman Show", poster: "https://image.tmdb.org/t/p/original/vuza0WqY239yBXOadKlGwJsZJFE.jpg" },
                { id: 10, title: "The Christmas Chronicles: Part Two", poster: "https://image.tmdb.org/t/p/original/6sG0kbEvAi3RRLcGGU5h8l3qAPa.jpg" },
                { id: 12, title: "The Nightmare Before Christmas", poster: "https://image.tmdb.org/t/p/original/oQffRNjK8e19rF7xVYEN8ew0j7b.jpg" },
                { id: 13, title: "Inside Out", poster: "https://image.tmdb.org/t/p/original/2H1TmgdfNtsKlU9jKdeNyYL5y8T.jpg" },
                { id: 14, title: "Formula 1: Drive To Survive", poster: "https://image.tmdb.org/t/p/original/bTvsFzYK4ZdbcAIPSEJ3i8uLHSh.jpg" },
                { id: 15, title: "Squid Game", poster: "https://image.tmdb.org/t/p/original/fRKEvCCELSZwPN5jw3VqvRDnLDZ.jpg" },
                { id: 16, title: "Klaus", poster: "https://image.tmdb.org/t/p/original/q125RHUDgR4gjwh1QkfYuJLYkL.jpg" },
                { id: 17, title: "Drake & Josh", poster: "https://image.tmdb.org/t/p/original/udCvGctktHvvf8w51XyTPfcmzDa.jpg" },
                { id: 19, title: "Home Alone 2: Lost in New York", poster: "https://image.tmdb.org/t/p/original/uuitWHpJwxD1wruFl2nZHIb4UGN.jpg" },
                { id: 21, title: "Smile 2", poster: "https://image.tmdb.org/t/p/original/ht8Uv9QPv9y7K0RvUyJIaXOZTfd.jpg" },
                { id: 24, title: "Dream Productions", poster: "https://image.tmdb.org/t/p/original/j9jz5wZlQoq65YuYPNauB72uvFJ.jpg" },
            ];

            searchBox.addEventListener('input', () => {
                const searchTerm = searchBox.value.toLowerCase().trim();
                
                if (searchTerm === '') {
                    searchResults.style.display = 'none';
                    return;
                }

                const filteredMovies = movies.filter(movie => 
                    movie.title.toLowerCase().includes(searchTerm)
                );

                if (filteredMovies.length > 0) {
                    searchResults.innerHTML = filteredMovies.map(movie => `
                        <div class="search-result-item" onclick="handleSearchResultClick(${movie.id})">
                            <img src="${movie.poster}" alt="${movie.title}">
                            <span class="title">${movie.title}</span>
                        </div>
                    `).join('');
                } else {
                    searchResults.innerHTML = `
                        <div class="no-results">
                            We don't have that unfortunately, but you can request it in the contact page!
                        </div>
                    `;
                }

                searchResults.style.display = 'block';
            });

            // Close search results when clicking outside
            document.addEventListener('click', (e) => {
                if (!searchBox.contains(e.target) && !searchResults.contains(e.target)) {
                    searchResults.style.display = 'none';
                }
            });
        });

        function handleSearchResultClick(movieId) {
            const searchContainer = document.querySelector('.search-container');
            searchContainer.classList.remove('active');
            document.querySelector('.search-box').value = '';
            document.querySelector('.search-results').style.display = 'none';
            document.body.style.overflow = '';
            
            setTimeout(() => {
                openModal(movieId);
            }, 100);
        }

        function openMobileSearch() {
            const searchContainer = document.querySelector('.search-container');
            searchContainer.classList.add('active');
            document.querySelector('.search-box').focus();
            document.body.style.overflow = 'hidden';
        }

        function closeMobileSearch() {
            const searchContainer = document.querySelector('.search-container');
            searchContainer.classList.remove('active');
            document.querySelector('.search-box').value = '';
            document.querySelector('.search-results').style.display = 'none';
            document.body.style.overflow = '';
        }

        // Add escape key handler
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const searchContainer = document.querySelector('.search-container');
                if (searchContainer.classList.contains('active')) {
                    closeMobileSearch();
                }
            }
        });

        // Add this to your existing DOMContentLoaded event listener
        document.addEventListener('DOMContentLoaded', () => {
            // ... existing code ...

            // Handle back button press to close search on mobile
            window.addEventListener('popstate', () => {
                if (document.querySelector('.search-container').classList.contains('active')) {
                    closeMobileSearch();
                }
            });
        });
    </script>

    <div class="build-number">Applicazione web BroFlix | Numero di Costruzione it-271224</div>
</body>
</html>